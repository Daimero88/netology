# Домашнее задание к занятию «Микросервисы: масштабирование» - Сильчин Сергей

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.

**Решение**  

Выбран следующий кластер для решения: Kubernetes + Helm + HashiCorp Vault + Istio  

**1. Kubernetes (основа кластера)**
- Поддержка контейнеров: Kubernetes (K8s) — это стандартная платформа для оркестрации контейнеров (Docker, containerd и др.).
- Горизонтальное масштабирование: K8s позволяет масштабировать поды (Pod) вручную (kubectl scale) или автоматически (Horizontal Pod Autoscaler, HPA).
- Обнаружение сервисов и маршрутизация: Встроенный механизм Service и DNS позволяет обнаруживать сервисы по имени, а Ingress-контроллеры (например, Nginx Ingress) управляют внешним доступом.
- Разделение ресурсов:
  - Namespaces позволяют изолировать окружения (dev/stage/prod).
  - Network Policies ограничивают сетевой трафик между подами.
  - Ingress и Service типа ClusterIP/NodePort/LoadBalancer разделяют доступ к сервисам (внутренний/внешний).

**2. Helm (управление конфигурацией)**  
- Конфигурирование приложений: Helm позволяет определять переменные среды через values.yaml и шаблонизировать манифесты K8s.
- Безопасное хранение секретов: Интеграция с HashiCorp Vault (через Helm Secrets или External Secrets Operator).

**3. HashiCorp Vault (управление секретами)**
- Хранение чувствительных данных: Vault шифрует и управляет доступом к паролям, ключам, сертификатам.
- Интеграция с Kubernetes:
  - Vault Agent Sidecar Injector автоматически подставляет секреты в поды как переменные среды или файлы.
  - Использование Vault через CSI Provider для динамических секретов.

**4. Istio (сервис-меш и продвинутая маршрутизация)**
- Обнаружение сервисов и балансировка нагрузки: Интеграция с K8s Service.
- Автоматическое масштабирование: Совместим с HPA, может учитывать кастомные метрики.
- Безопасность: mTLS для шифрования трафика между сервисами, авторизация на уровне RBAC.
- Разделение доступа:
  - Gateway (аналог Ingress) для внешнего трафика.
  - VirtualService для внутренней маршрутизации.

**Обоснование выбора:**  
Kubernetes — стандарт для оркестрации контейнеров, покрывает базовые требования (масштабирование, сервисы, изоляция).  
Helm — упрощает управление сложными конфигурациями, поддерживает переиспользование чартов.  
HashiCorp Vault — специализированное решение для секретов с аудитом и ротацией, безопаснее встроенных K8s Secrets.  
Istio — дополняет K8s продвинутыми возможностями (A/B-тестирование, canary-развертывания, observability), но может быть заменен на более простые инструменты (например, Nginx Ingress + Cert-Manager), если не нужен сервис-меш.  

